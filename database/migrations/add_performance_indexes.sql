-- ============================================================
-- إضافة فهارس لتحسين الأداء
-- ============================================================
-- هذا الملف يضيف فهارس إضافية للجداول الأكثر استخداماً
-- لتحسين سرعة الاستعلامات والتنقل بين الصفحات
-- ============================================================
-- تحذير: سيتخطى MySQL إنشاء الفهرس إذا كان موجوداً بالفعل
-- ============================================================

-- ============================================================
-- جدول users
-- ============================================================

-- فهرس مركب لـ id و status (مستخدم بكثرة في getCurrentUser)
-- يتم استخدامه في: SELECT * FROM users WHERE id = ? AND status = 'active'
ALTER TABLE `users` 
ADD INDEX `idx_id_status` (`id`, `status`);

-- فهرس لـ role و status (للبحث عن المستخدمين النشطين بدور معين)
ALTER TABLE `users` 
ADD INDEX `idx_role_status` (`role`, `status`);

-- ============================================================
-- جدول notifications (إذا كان موجوداً)
-- ============================================================

-- فهرس مركب لـ user_id و is_read (الأكثر استخداماً)
ALTER TABLE `notifications` 
ADD INDEX `idx_user_read` (`user_id`, `is_read`);

-- فهرس لـ created_at (للترتيب)
ALTER TABLE `notifications` 
ADD INDEX `idx_created_at` (`created_at`);

-- فهرس مركب لـ user_id و created_at (للحصول على أحدث الإشعارات)
ALTER TABLE `notifications` 
ADD INDEX `idx_user_created` (`user_id`, `created_at`);

-- ============================================================
-- جدول remember_tokens
-- ============================================================

-- فهرس مركب لـ user_id و expires_at (للتحقق من صلاحية التوكن)
-- Note: قد يكون موجوداً بالفعل، سيتخطاه MySQL
ALTER TABLE `remember_tokens` 
ADD INDEX `idx_user_expires` (`user_id`, `expires_at`);

-- فهرس مركب لـ token و expires_at (للتحقق السريع)
ALTER TABLE `remember_tokens` 
ADD INDEX `idx_token_expires` (`token`, `expires_at`);

-- ============================================================
-- جدول attendance
-- ============================================================

-- فهرس مركب لـ user_id و date (للحصول على سجلات حضور مستخدم)
-- Note: قد يكون موجوداً بالفعل كـ UNIQUE KEY
ALTER TABLE `attendance` 
ADD INDEX `idx_user_date` (`user_id`, `date`);

-- ============================================================
-- جدول audit_log (إذا كان موجوداً)
-- ============================================================

-- فهرس لـ user_id (للحصول على سجلات مستخدم)
ALTER TABLE `audit_log` 
ADD INDEX `idx_user_id` (`user_id`);

-- فهرس لـ created_at (للترتيب)
ALTER TABLE `audit_log` 
ADD INDEX `idx_created_at` (`created_at`);

-- فهرس مركب لـ user_id و created_at
ALTER TABLE `audit_log` 
ADD INDEX `idx_user_created` (`user_id`, `created_at`);

-- ============================================================
-- جدول customers (إذا كان موجوداً)
-- ============================================================

-- فهرس لـ name (للبحث)
ALTER TABLE `customers` 
ADD INDEX `idx_name` (`name`);

-- فهرس لـ phone (للبحث)
ALTER TABLE `customers` 
ADD INDEX `idx_phone` (`phone`);

-- ============================================================
-- ملاحظات:
-- ============================================================
-- 1. إذا ظهرت رسالة خطأ "Duplicate key name"، هذا يعني أن الفهرس موجود بالفعل
--    ويمكن تجاهل الخطأ بأمان
-- 2. الفهارس المركبة مفيدة للاستعلامات التي تستخدم أكثر من عمود
-- 3. يمكن إضافة فهارس أخرى حسب الحاجة بعد مراقبة الأداء
-- 4. استخدم EXPLAIN قبل وبعد إضافة الفهارس لمقارنة الأداء
-- ============================================================
