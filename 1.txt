[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Processing create_shipping_order - itemsInput count: 1
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Processing itemsInput[0]: {"product_id":"1000010","batch_id":"10","product_type":"factory","quantity":"1","unit_price":"1000.00"}
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: RAW quantity from form: '1' -> parsed: 1 for product_id: 1000010
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: BEFORE grouping - normalizedItems count: 1, items: [{"product_id":10,"quantity":1,"unit_price":1000,"total_price":1000,"batch_id":10,"product_type":"factory"}]
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Grouping item[0]: key='10_10_factory', product_id=10, batch_id=10, quantity=1, product_type=factory
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: NEW grouped item with key '10_10_factory', quantity: 1
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Final grouped item '10_10_factory': quantity=1, total_price=1000
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: AFTER grouping - items count: 1, normalizedItems: [{"product_id":10,"quantity":1,"unit_price":1000,"total_price":1000,"batch_id":10,"product_type":"factory"}]
[05-Dec-2025 16:09:36 Africa/Cairo] Generated unique invoice number: INV-202512-0092
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Linking batch - batchId: 10, fp data: {"batch_number":"251204-543605","batch_id":10}
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Found batch_number from finished_products: 251204-543605
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Found batch_number_id: 10 for batch_number: 251204-543605
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Successfully linked batch_number_id 10 to invoice_item_id 152 with quantity 1
[05-Dec-2025 16:09:36 Africa/Cairo] recordInventoryMovement: Called with product_id: 10, warehouse_id: 2, type: out, quantity: 1, batch_id: 10, reference_type: shipping_order
[05-Dec-2025 16:09:36 Africa/Cairo] recordInventoryMovement: Checking conditions - batchId: 10, type: out, usingVehicleInventory: false
[05-Dec-2025 16:09:36 Africa/Cairo] recordInventoryMovement: Searching for finished_products with batch_id: 10, product_id: 10, type: out, reference_type: shipping_order
[05-Dec-2025 16:09:36 Africa/Cairo] recordInventoryMovement: Found finished_products with id=10, quantity_produced=87
[05-Dec-2025 16:09:36 Africa/Cairo] recordInventoryMovement: Using finished_products.quantity_produced = 87 for batch_id: 10, product_id: 10, reference_type: shipping_order
[05-Dec-2025 16:09:36 Africa/Cairo] recordInventoryMovement: Updated finished_products.quantity_produced - batch_id: 10, quantity_before: 87, quantity_requested: 1, quantity_after_calculated: 86, current_before_update: 87, current_after_update: 86
[05-Dec-2025 16:09:36 Africa/Cairo] shipping_orders: Added quantity to products.quantity for product with batch_id - Order: SHIP-202512-0029, Finished Product ID (batch_id): 10, Actual Product ID: 11, Quantity Added: 1.00, Previous Quantity: 1.00, New Quantity: 2.00
